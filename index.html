<!DOCTYPE html>
<html>
<head>
<title>Мафия Онлайн</title>
<meta charset="UTF-8" />
<style>
body { font-family: sans-serif; padding: 20px; max-width: 400px; margin: auto; }
.hidden { display:none; }
button { padding: 10px 20px; margin-top: 10px; }
input { padding: 8px; width: 100%; margin-top: 10px; }
</style>
</head>
<body>

<h1>Мафия Онлайн</h1>

<div id="start">
  <button onclick="createRoom()">Создать комнату</button>
  <hr>
  <input id="joinRoomId" placeholder="ID комнаты">
  <input id="joinName" placeholder="Ваше имя">
  <button onclick="joinRoom()">Войти</button>
</div>

<div id="host" class="hidden">
  <h3>Комната: <span id="roomIdHost"></span></h3>
  <h3>Игроки:</h3>
  <div id="players"></div>

  <h3>Роли:</h3>
  <label>Мафия: <input type="number" id="roleMafia" value="1"></label><br>
  <label>Доктор: <input type="number" id="roleDoctor" value="1"></label><br>
  <label>Комиссар: <input type="number" id="roleCop" value="1"></label><br>

  <button onclick="assignRoles()">Раздать роли</button>
</div>

<div id="player" class="hidden">
  <h3>Комната: <span id="roomIdPlayer"></span></h3>
  <h2 id="role"></h2>
</div>

<script>
let ws = new WebSocket("https://mafia-c6a2.onrender.com");

let currentRoom = "";

ws.onmessage = (ev) => {
  const msg = JSON.parse(ev.data);

  if (msg.type === "room_created") {
    currentRoom = msg.roomId;
    document.getElementById("roomIdHost").textContent = currentRoom;
    document.getElementById("start").classList.add("hidden");
    document.getElementById("host").classList.remove("hidden");
  }

  if (msg.type === "joined") {
    currentRoom = msg.roomId;
    document.getElementById("roomIdPlayer").textContent = currentRoom;
    document.getElementById("start").classList.add("hidden");
    document.getElementById("player").classList.remove("hidden");
  }

  if (msg.type === "player_list") {
    document.getElementById("players").textContent = msg.players.join(", ");
  }

  if (msg.type === "your_role") {
    document.getElementById("role").textContent = "Ваша роль: " + msg.role;
  }

  if (msg.type === "error") alert(msg.message);
};

function createRoom() {
  ws.send(JSON.stringify({ type: "create_room" }));
}

function joinRoom() {
  ws.send(JSON.stringify({
    type: "join_room",
    roomId: document.getElementById("joinRoomId").value,
    name: document.getElementById("joinName").value
  }));
}

function assignRoles() {
  let roles = [];
  roles.push(...Array(Number(document.getElementById("roleMafia").value)).fill("Мафия"));
  roles.push(...Array(Number(document.getElementById("roleDoctor").value)).fill("Доктор"));
  roles.push(...Array(Number(document.getElementById("roleCop").value)).fill("Комиссар"));

  ws.send(JSON.stringify({
    type: "assign_roles",
    roomId: currentRoom,
    roles
  }));
}
</script>

</body>
</html>
